name: Run Robot Test

on:
  workflow_dispatch:
    inputs:
      hum-token:
        description: "Humanitec Token"
        required: true
      hum-org:
        description: "Humanitec Org"
        required: true
      image-name:
        description: "Image Name"
        required: true

env:
  HUMANITEC_TOKEN: ${{ github.event.inputs.hum-token }}
  HUMANITEC_ORG: ${{ github.event.inputs.hum-org }}
  IMAGE_NAME: ${{ github.event.inputs.image-name }}

jobs:
  notify-humanitec:
    runs-on: ubuntu-latest
    env:
      REGISTRY: ghcr.io/test
    steps:
      - name: Send Image Notification
        uses: fjogeleit/http-request-action@v1
        with:
          url: "https://api.humanitec.io/orgs/${{ env.HUMANITEC_ORG }}/images/${{ env.IMAGE_NAME }}/builds"
          method: "POST"
          bearerToken: ${{ env.HUMANITEC_TOKEN }}
          data: |
            {
              "branch": "'${{ github.ref }}'",
              "commit": "'${{ github.sha }}'",
              "image": "'${{ env.REGISTRY }}'/'${{ github.event.repository.name }}':'${{ github.ref.name }}'",
              "tags": ["'${{ github.ref.name }}'"],
            }
